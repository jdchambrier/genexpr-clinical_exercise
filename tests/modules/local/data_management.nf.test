nextflow_process {

    name "Test Process DATA_MANAGEMENT"
    script "modules/local/data_management.nf"
    process "DATA_MANAGEMENT"

    test("Should run without failures") {
        
        when {
            process {
                """
                // define inputs of the process here. Example:
                input[0] = file("${projectDir}/test_data/test_data.csv")
                input[1] = file("${projectDir}/bin/management.Rmd")
                container = 'rpreprocess:0.1'
                """
            }
        }

        then {
            assert process.success

            with(process.out){
                assert clean_data.size() == 1
                assert snapshot(clean_data).match("clean_data")
                assert data_management_report.size() == 1
                def lines = file(data_management_report[0]).readLines()
                assert snapshot(lines[0..10]).match("management_report_10lines")
                assert versions.size() == 1
                assert snapshot(versions).match("versions")
            }
            
        }

    }

}
